# OSM AI - QGISプラグイン
![demo](https://github.com/user-attachments/assets/d87e510e-8ad2-4099-bdaf-26d723e7efbf)

[English](README.md) | 日本語

## 概要

**OSM AI**は、チャットインターフェースを使ってOpenStreetMapデータを検索・取得できるQGISプラグインです。LLM（OpenAI API）を使用して自動的にOverpass QLクエリを生成し、OSMデータをQGISレイヤーとして追加します。

* **注意**: OpenAI APIキーの取得が必要です。API利用料金はユーザーの負担となります。

## インストール

### ZIPファイルからインストール

1. **プラグインのZIPファイルをダウンロード**

   こちらからダウンロード：
   
   👉 **[osm_ai.zipをダウンロード](https://github.com/user-attachments/files/24428320/osm_ai.zip)**

2. **QGISを開き**、**「プラグイン」→「プラグインの管理とインストール」**へ移動

3. **「ZIPからインストール」**タブを選択

4. ダウンロードした**`osm_ai.zip`**を選択してインストール

5. **「インストール済み」**タブで「OSM AI」を有効化

## セットアップ

### OpenAI APIキーの取得

1. [OpenAI Platform](https://platform.openai.com/)にアクセスしてアカウントを作成

2. [APIキー](https://platform.openai.com/api-keys)ページで新しいAPIキーを作成

3. APIキーをコピー

4. QGISでAPI設定ページを開く
**「プラグイン」→「OSM AI Agent」→「設定」**
<img width="500" height="500" alt="image" src="https://github.com/user-attachments/assets/c979195e-aa90-4910-af2b-85be30a88575" />

5. APIキーを設定
<img width="500" height="500" alt="API setting page" src="https://github.com/user-attachments/assets/0526c26c-c3fa-4914-87d5-fcb26e8b0e12" />

## 主な機能

### チャットベースのデータ検索
- **多言語サポート**: UIの言語はQGISの言語設定に自動的に適応（日本語、英語、中国語、スペイン語など）
- **会話型インターフェース**: チャットのように自然な言葉でリクエストを入力

### チャット機能
- **複数タブ**: 複数のタブで異なる検索タスクを並行実行
- **履歴保持**: 各タブは独自のチャット履歴を保持し、文脈を理解した検索が可能

### 柔軟な地理検索
1. **現在のビュー検索**: 地図ビューのバウンディングボックスを自動検出
2. **場所ベースの検索**: 地名で検索（例：「横浜の市役所」「渋谷のカフェ」）

### キーボードショートカット
- **Enter**または**Command+Enter**でメッセージを送信（設定可能）
- 効率的な操作

## 必要要件

- **QGIS**: 3.x以上
- **Python**: 3.9以上（QGISに含まれています）
- **インターネット接続**: OpenAI APIとOverpass APIに必要
- **OpenAI APIキー**: [OpenAI Platform](https://platform.openai.com/)から取得

### プラグインでAPIキーを設定

1. QGISでプラグインを有効化した後、ツールバーの**OSM AIアイコン**をクリック

2. ドックウィジェットが表示されたら、右上の**⚙️ 設定アイコン**をクリック

3. **「OpenAI API Key」**フィールドにAPIキーを貼り付け

4. 好みの**「送信ショートカット」**を選択：
   - **Enter**: Enterキーで送信（Shift+Enterで改行）
   - **Command+Enter**（推奨）: Command+Enter（Mac）またはCtrl+Enter（Windows/Linux）で送信

5. **「OK」**をクリックして保存

> **💡 ヒント**: `OPENAI_API_KEY`環境変数を設定すれば、プラグイン設定で入力する必要はありません。

## 使い方

### 基本的な使い方

1. **QGISプロジェクトを開く**  
   探索したいエリアを地図ビューに表示

2. **プラグインを起動**  
   ツールバーの**OSM AIアイコン**をクリック、またはメニューから**「プラグイン」→「OSM AI」**を選択

3. **自然言語で検索**  
   自然な言葉でリクエストを入力

   **例**:
   - 「東京のコンビニを表示して」
   - 「現在のビューにある公園を表示」
   - 「ニューヨークの美術館を表示」

4. **送信**  
   - **送信ボタン**をクリック
   - または**Enter**（または**Command+Enter**）を押す

5. **データが自動的に追加される**  
   - プラグインがOverpass QLクエリを生成
   - Overpass APIからOSMデータを取得
   - QGISのレイヤーパネルに新しいレイヤーを追加

### 複数タブ

複数の検索タスクを並行して実行できます：

1. **新しいタブを作成**: 入力フィールドの上にある**➕アイコン**をクリック

2. **タブを切り替え**: タブをクリックして切り替え

3. **タブを閉じる**: タブの**✕アイコン**をクリック

各タブは独自のチャット履歴を持ち、文脈を理解した会話が可能です。

### チャット機能

OSM AIは単なるデータ検索ツールではなく、会話型で使用できます：

- **挨拶**: 「こんにちは」と言えば応答します
- **質問**: 「このプラグインの使い方は？」と尋ねられます
- **文脈理解**: 以前のメッセージを覚えているので、「もっと見せて」と言えます

## 設定

### キーボードショートカット

**設定画面**（⚙️アイコン）で送信ショートカットを選択できます：

- **Enter**: 
  - メッセージ送信: **Enter**
  - 改行: **Shift+Enter**
  
- **Command+Enter**（推奨）:
  - メッセージ送信: **Command+Enter**（Mac）または**Ctrl+Enter**（Windows/Linux）
  - 改行: **Enter**

## 技術情報

### 使用API

- OpenAI API
- Overpass API

### ディレクトリ構造

```
osm_ai/
├── __init__.py              # プラグインエントリーポイント
├── metadata.txt             # プラグインメタデータ
├── osm_ai_plugin.py         # メインプラグインコード
├── icon.png                 # プラグインアイコン
├── resources.qrc            # Qtリソース定義
├── resources.py             # Qtリソース（生成）
├── core/                    # コアロジック
│   ├── __init__.py
│   ├── settings.py          # 設定管理（APIキー、ショートカット）
│   ├── llm_client.py        # OpenAI API呼び出し
│   ├── overpass_client.py   # Overpass API呼び出し
│   └── qgis_utils.py        # QGIS統合（レイヤー追加など）
└── ui/                      # ユーザーインターフェース
    ├── __init__.py
    ├── osm_ai.ui            # Qt Designer UIファイル
    ├── osm_ai_form.py       # 生成されたUIコード
    └── icon/                # SVGアイコン
        ├── agent.svg
        ├── user.svg
        ├── plus.svg
        ├── xmark.svg
        └── sent.svg
```

すべての依存関係は標準的なQGIS環境に含まれており、追加のインストールは不要です。

## よくある質問

**Q: OpenAI API以外のLLM（Claude、Geminiなど）を使用できますか？**  
A: 現在はOpenAI APIのみサポートしています。他のプロバイダーのサポートは将来的に予定しています。

**Q: API利用料金はかかりますか？**  
A: はい。OpenAI APIは従量課金制です。ユーザーが自身のAPI費用を負担します。将来的には、ユーザーがOpenAI APIキーを提供する必要のないバージョンの開発を計画しています。

**Q: オフラインで使用できますか？**  
A: いいえ。インターネット接続が必要です。

**Q: どのような種類のデータを取得できますか？**  
A: OpenStreetMapで利用可能なすべてのデータ（POI、道路、建物、土地利用など）。

**Q: 英語以外の言語を使用できますか？**  
A: はい。日本語、英語、中国語、スペイン語など、複数の言語をサポートしています。UIはQGISの言語設定に自動的に適応します。

## ライセンス

このプロジェクトはGNU General Public License v3.0の下でライセンスされています。詳細は[LICENSE](LICENSE)ファイルを参照してください。

### これはどういう意味ですか？

- ✅ 商用利用を含め、あらゆる目的でこのプラグインを**使用**できます
- ✅ このプラグインを**変更**および**再配布**できます
- ❌ 変更版を配布する場合は、以下が必要です：
  - ソースコードを公開する
  - 同じGPL v3ライセンスを使用する
  - 行った変更を明記する

これにより、プラグインがオープンソースのままであることが保証され、クローズドソースの商用派生物が防止されます。

## サポート

バグレポート、機能リクエスト、質問については、お気軽にお問い合わせください。

連絡先: origami.no.1@gmail.com

